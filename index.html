<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Área Restrita</title>
<style>
body {
    background:#0f172a;
    font-family:Arial;
    color:white;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}
.box {
    background:#020617;
    padding:25px;
    border-radius:10px;
    width:320px;
}
input, button {
    width:100%;
    padding:10px;
    margin-top:10px;
}
button {
    background:#22c55e;
    border:none;
    cursor:pointer;
}
.hidden {
    display:none;
}
.error {
    color:#f87171;
    margin-top:10px;
}
</style>
</head>
<body>

<div class="box" id="loginBox">
    <h2>Login Seguro</h2>

    <!-- honeypot -->
    <input type="text" id="email_fake" class="hidden">

    <input type="text" id="u">
    <input type="password" id="p">
    <input type="hidden" id="token">

    <button onclick="login()">Entrar</button>
    <div class="error" id="msg"></div>
</div>

<div class="box hidden" id="home">
    <h2>Bem-vindo</h2>
    <p>Acesso autorizado</p>
</div>

<script>
/* ===== CONFIGURAÇÃO ===== */
const usuarios = {
    "admin": "03ac674216f3e15c761ee1a5e255f067953623c8b388b4459e13f978d7c846f4", // 1234
    "joao":  "ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f"  // senha
};

let tentativas = 3;
const tempoMinimo = 2000; // 2 segundos
const inicio = Date.now();

/* ===== TOKEN ===== */
const tokenGerado = Math.random().toString(36).substring(2);
document.getElementById("token").value = tokenGerado;

/* ===== CAMPOS DINÂMICOS ===== */
document.getElementById("u").placeholder = "Usuário";
document.getElementById("p").placeholder = "Senha";

/* ===== FUNÇÃO HASH ===== */
async function sha256(texto) {
    const data = new TextEncoder().encode(texto);
    const hash = await crypto.subtle.digest("SHA-256", data);
    return Array.from(new Uint8Array(hash))
        .map(b => b.toString(16).padStart(2, '0'))
        .join('');
}

/* ===== LOGIN ===== */
async function login() {
    const agora = Date.now();
    const msg = document.getElementById("msg");

    if (document.getElementById("email_fake").value !== "") {
        msg.innerText = "Acesso negado";
        return;
    }

    if (agora - inicio < tempoMinimo) {
        msg.innerText = "Aguarde alguns segundos";
        return;
    }

    if (tentativas <= 0) {
        msg.innerText = "Acesso bloqueado";
        return;
    }

    const user = document.getElementById("u").value;
    const pass = document.getElementById("p").value;
    const token = document.getElementById("token").value;

    if (!token) {
        msg.innerText = "Sessão inválida";
        return;
    }

    const passHash = await sha256(pass);

    if (usuarios[user] === passHash) {
        document.getElementById("loginBox").classList.add("hidden");
        document.getElementById("home").classList.remove("hidden");
    } else {
        tentativas--;
        msg.innerText = "Erro. Tentativas restantes: " + tentativas;
    }
}
</script>

</body>
</html>
